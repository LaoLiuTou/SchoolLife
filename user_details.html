<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<title>个人详情</title>
		<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
		<meta content="yes" name="apple-mobile-web-app-capable">
		<meta content="black" name="apple-mobile-web-app-status-bar-style">
		<meta content="telephone=no" name="format-detection">
		<link rel="stylesheet" href="css/weui.css">
		<link rel="stylesheet" href="css/jquery-weui.css">
		<link rel="stylesheet" href="css/style.css">
		<link rel="stylesheet" type="text/css" href="css/swipeslider.css">
		<link rel="stylesheet" href="css/baguetteBox.css">
	</head>

	<body>
		<div class="head bbqdetahead">
			<div  class="indexreturn bbqreturn" onclick="window.history.go(-1)">
				<img src="images/geren-fanh-icon.png" />
			</div>
			<span id="navtext"></span>
		</div>
		<div class=" bbqdetailshead">

		</div>
		<div class="weui-navbar bbqwid90 bbqdetailsbg"id="userinfo">
			<div class="bbqlistimg ">
				<img id="i_upimg" src="images/9f10f09c24c4611808bcccd9b5302a3.jpg">
			</div>
			<p class="bbqname bbqgrjname" ><span class="vermiddle" id="nickname"></span><img class="bbqxb" src="images/nan-icon.png"></p>
			<div class="bbqguanzword bbqdetails" style="padding-left: 0.8rem;">
				<div class="bbqguanzlabel fl">
					<img src="images/xuexiao-icon.png">
					<span id="sc_nm" class=""></span>
				</div>
				<div class="bbqguanzlabelt">
					<div id="level_name_icon" class="bbqguanzdj">1</div>
					<span id="level_name" class="">童生</span>
				</div>
				<div class="bbqderailsbtn">
					<div id="followBtn" class="bbqdetailgz"><img src="images/guanzhu-icon.png"></div>
					<div id="paperBtn" class="bbqdetailgz" id="sendPaper">发送小纸条</div>
				</div>
			</div>

		</div>
		<div class="bbqwid90 detailslist" style="overflow:auto;height: 88%;">
			<div class="weui-pull-to-refresh__layer" >
				<div class='weui-pull-to-refresh__arrow'></div>
				<div class='weui-pull-to-refresh__preloader'></div>
				<div class="down">下拉刷新</div>
				<div class="up">释放刷新</div>
				<div class="refresh">正在刷新</div>
			</div>

			<ul class="bbqdetails" id="contentUl">
					<!--<li class="bbqdetalistbg">
						<p class="detailstime"><span>04</span>/<span>16</span></p>
						<div class="detailsborder"></div>
						<div class="bbqdetalist ">
								<p class="bbqneir">我今天九年级了，我还得上补课班，我最爱吃冰激凌啦！</p>
								<div class="baguetteBoxOne  bbqlistimgs" >
							        <a style="background-image: url(images/9f10f09c24c4611808bcccd9b5302a3.jpg);" class="listimgs" href="images/9f10f09c24c4611808bcccd9b5302a3.jpg" >
							        </a>
							        <a style="background-image: url(images/f829f187ae0acce4e1e8752cfc8e9f2.jpg);" class="listimgs" href="images/f829f187ae0acce4e1e8752cfc8e9f2.jpg" >
							        </a>
							        <a style="background-image: url(images/bbqbanner.png);"  class="listimgs" href="images/bbqbanner.png">
							        </a>
							    </div>
							    <div class="bbqbuttonthree">
									<img src="images/dianzan-icon.png" />
									<span class="bbqbuttonspan">999+</span>
									<span class="locationpl">
										<img src="images/pinglun-icon.png" />
										<span class="bbqbuttonspan">999+</span>
									</span>
									<img class="fr bbqgengdtc" src="images/gengduo.png" />
								</div>
						</div>
					</li>
					<li class="bbqdetalistbg">
						<p class="detailstime"><span>04</span>/<span>16</span></p>
						<div class="detailsborder"></div>
						<div class="bbqdetalist ">
								<p class="bbqneir">我今天九年级了，我还得上补课班，我最爱吃冰激凌啦！</p>
								<div class="baguetteBoxOne  bbqlistimgs" >
							        <a style="background-image: url(images/9f10f09c24c4611808bcccd9b5302a3.jpg);" class="listimgs" href="images/9f10f09c24c4611808bcccd9b5302a3.jpg" >
							        </a>
							        <a style="background-image: url(images/f829f187ae0acce4e1e8752cfc8e9f2.jpg);" class="listimgs" href="images/f829f187ae0acce4e1e8752cfc8e9f2.jpg" >
							        </a>
							        <a style="background-image: url(images/bbqbanner.png);"  class="listimgs" href="images/bbqbanner.png">
							        </a>
							    </div>
							    <div class="bbqbuttonthree">
									<img src="images/dianzan-icon.png" />
									<span class="bbqbuttonspan">999+</span>
									<span class="locationpl">
										<img src="images/pinglun-icon.png" />
										<span class="bbqbuttonspan">999+</span>
									</span>
									<img class="fr bbqgengdtc" src="images/gengduo.png" />
								</div>
						</div>

					</li>-->
			</ul>

			<div class="weui-loadmore" style="display:none;">
				<i class="weui-loading"></i>
				<span class="weui-loadmore__tips">正在加载</span>
			</div>
		</div>
		</div>


		<!--收藏弹出-->
		<div class="bbqshoucangtanc">
			<img src="images/shoucang-icon.png">
		</div>

		<!--更多弹出-->
		<div class="bbqgengdtanc">
			<div class="gengdbg">
				<div class="tit bbqscbtn">收藏</div>
				<div class="tit bbqjbbtn">举报</div>
				<div class="bbqqxbtn titbtn">取消</div>
			</div>
		</div>
		<!--举报弹出-->
		<div class="bbqjubtanc" style="display: none;">
			<div class="gengdbg" id="jubaoDiv">

			</div>
		</div>


		<script src="js/jquery.min.js"></script>
		<script src="js/jquery-weui.min.js"></script>

		<script type="text/javascript" src="js/swipeslider.min.js"></script>

		<!--图片展开-->
		<script src="js/baguetteBox.js" async></script>
		<script src="js/highlight.min.js" async></script>
		<script>
		window.onload = function() {


		    baguetteBox.run('.baguetteBoxOne');
		    $('#baguetteBox-overlay').prepend("<div class='bbqtpword bbqwid90'>"+
		    "<span class='tpspan'>123123123123123123123123123123123123123123123123123123<span>"+
		    "<div class='bbqbuttonthree bbqphotobtn'>"+
			"<img src='images/tp-dianzan.png'>"+
		 	"<span class='bbqbuttonspan'>99</span>"+
		 	"<span class='locationpl'>"+
			"<img src='images/tp-pinglun.png'>"+
			"<span class='bbqbuttonspan'>9999</span>"+
		 	"</span>"+
	 		"</div></div>"+
	 		"<div class='tpzhankbtn'><span>展开</span><img src='images/jiantoubottom-icon.png'></div>");
	 		$(".tpzhankbtn").click(function(){
	 			var spanbtn = $('.tpzhankbtn span').text();
	 			if(spanbtn == '展开'){
	 				$('.bbqtpword').show();
	 				$('.tpzhankbtn img').css({'transform':'rotate(-180deg)','transition':'0.2s'})
	 				$('.tpzhankbtn span').text('收起');
	 			}else if(spanbtn == "收起"){
	 				$('.bbqtpword').hide();
	 				$('.tpzhankbtn img').css({'transform':'rotate(0deg)','transition':'0.2s'})
 					$('.tpzhankbtn span').text('展开');
	 			}
	 		})
							 
		};
		</script>
		<!--具体功能实现-->
		<script type="text/javascript" src="js/main/config.js"></script>
		<script>
			var page=1;
            var loading = false;
            var talkId;
            $(document).ready(function () {

                $('.detailslist').pullToRefresh().on('pull-to-refresh', function (done) {
                    var self = this;
                    $(self).find(".weui-loadmore").html('<i class="weui-loading"></i><span class="weui-loadmore__tips">正在加载</span>');


                    setTimeout(function() {
                        page=1;
                        var bodyParam = {'USER_ID': user_id,'OTHER_ID':GetQueryString('id'),'PAGE':page};
                        listTalkHistory(bodyParam,'refresh');
                    }, 2000);

                });

                $(".detailslist").infinite().on("infinite", function() {
                    var self = this;
                    if(loading) return;
                    $(self).find(".weui-loadmore").show();
                    loading = true;

                    setTimeout(function() {
                        page++;
                        var bodyParam = {'USER_ID': user_id,'OTHER_ID':GetQueryString('id'),'PAGE':page};
                        listTalkHistory(bodyParam,'load');

                    }, 2000);

                });

                $('#followBtn').click(function(){
                    var bodyParam = {'USER_ID':user_id,'ATT_USER_ID': GetQueryString('id'),'SAVECEN':'1'};
                    follow(bodyParam);
				});
                $('#paperBtn').click(function(){
                    window.location.href='push_paperstrip.html?id='+ GetQueryString('id')+'&name='+$('#nickname').text();
				});

                var bodyParam = {'USER_ID': GetQueryString('id')};
                getUserInfo(bodyParam);
                bodyParam = {'USER_ID': user_id,'OTHER_ID':GetQueryString('id'),'PAGE':page};
                listTalkHistory(bodyParam,'refresh');
                listReport();

                //收藏弹出

                $('body').on('click','.bbqgengdtc',function(e){
                    $(".bbqgengdtanc").show();
                    $(".bbqqxbtn").click(function(){
                        $('.bbqgengdtanc').hide();
                    });
                    talkId=$(this).attr('itemId');
                    e.stopPropagation();
                });
                $(".bbqscbtn").click(function() {
                    $('.bbqshoucangtanc').show();
                    $('.bbqgengdtanc').hide();
                    setTimeout(function() { //定时器
                            $(".bbqshoucangtanc").css("display", "none");

                        },
                        1000);
                    var bodyParam = {'USER_ID': user_id,'TALK_ID':talkId,'SAVECEN':'1'};
                    saveTalk(bodyParam);

                });




                //举报弹出
                $(".bbqjbbtn").click(function() {

                    $('.bbqjubtanc').show();
                    $('.bbqgengdtanc').hide();

                });
                $('body').on('click','#cancelJbBtn',function () {
                    $('.bbqjubtanc').hide();
                });
                $('body').on('click','.jubaotit',function () {
                    $('.jubaotit').removeClass('bbqtcxz');
                    $(this).addClass('bbqtcxz');
                    if($(this).text()=='其他'){
                        $('#jbText').show();
                    }
                    else{
                        $('#jbText').hide();
                    }
                });
                $('body').on('click','#addJbBtn',function () {
                    if($('#jubaoDiv .bbqtcxz').length==0){
                        $.toast("请选择举报原因！", "text");
                        return false;
                    }

                    var bodyParam = {'USER_ID': user_id,'TALK_ID':talkId,'REPORT_REASON_ID':$('.bbqtcxz').attr('itemId')};
                    if($('.bbqtcxz').text()=='其他'){
                        if($('#jbText').val()==''){
                            $.toast("请输入举报原因！", "text");
                            return false;
                        }
                        bodyParam['REPORT_REASON_OTHER']=$('#jbText').val();
                    }
                    addReport(bodyParam);
                    $('.bbqjubtanc').hide();
                });
                //item 点击
                $('body').on('click','.bbqdetalistbg',function(){
                    window.location.href='post_details.html?id='+$(this).attr("itemId");
                });

            });

            /**
             * 用户信息
             */
            function getUserInfo(bodyParam) {
                var hrt = new HttpRequestTool(url + 'cxXsList', 'post', 'text', true, false, bodyParam, 'callBack');
                hrt.HttpRequest(function (response) {
                    var obj = JSON.parse(response);
                    var data = obj['Result'];
                    console.log(response);
                    if(data.length>0){
                        $('#navtext').text(data[0]['NICKNAME']);
                        $('#nickname').text(data[0]['NICKNAME']);
                        $('#sc_nm').text(data[0]['NM_T']);
                        if(data[0]['LEVEL']!=null) {
                            $('#level_name').text(data[0]['LEVEL_NAME']);
                            $('#level_name_icon').text( getLevelbyName(data[0]['LEVEL_NAME']));
                        }
                        if(data['I_UPIMG']!=null){
                            $('#i_upimg').prop('src',data[0]['I_UPIMG']);
                        }
                    }
                });
            }


            /**
             * 话题列表
             */
            function listTalkHistory(bodyParam,refreshorload) {

                var hrt = new HttpRequestRefreshTool(url + 'cxTalkHistory', 'post', 'text', true, false, bodyParam, 'callBack');
                hrt.HttpRequest(function (response) {
                    var obj = JSON.parse(response);
                    var data = obj['Result'];

                    console.log(response);
                    var html='';

                    if(data.length==0&&refreshorload=='load'){
                        loading = true;
                        $(".weui-loadmore").show();
                        $(".weui-loadmore").html('<span class="weui-loadmore__tips">已无更多数据</span>');
                    }
                    else{
                        for(j = 0,len=data.length; j < len; j++) {

                            var date=new Date(data[j].OPEN_DT);
                            html+='<li class="bbqdetalistbg" itemId="'+data[j].ID+'">\n' +
                                '<p class="detailstime"><span>'+(date.getMonth()+1)+'</span>/<span>'+date.getDate()+'</span></p>\n' +
                                '<div class="detailsborder"></div>\n' +
                                '<div class="bbqdetalist ">\n' +
                                '<p class="bbqneir">'+data[j].TALK_CONTENT+'</p>\n' ;
                            html+='<div class="baguetteBoxOne  bbqlistimgs" >\n';
							var contentImage=data[j].TALK_IMG;
								if(contentImage!=null){
									var contentImages=contentImage.split("|");
									if(contentImages.length>0){
										for(i = 0,imagelen=contentImages.length; i< imagelen;i++) {
											html+='<a class="listimgs" style="background-image: url('+contentImages[i]+');" href="'+contentImages[i]+'" >\n' +
												'</a>\n' ;
										}
									}
								}
                            html+='    </div>';
                            html+='<div class="bbqbuttonthree">\n' +
                                '<img src="images/dianzan-icon.png" />\n' +
                                '<span class="bbqbuttonspan">'+data[j].GOOD_COUNT+'</span>\n' +
                                '<span class="locationpl">\n' +
                                '<img src="images/pinglun-icon.png" />\n' +
                                '<span class="bbqbuttonspan">'+data[j].REPLAYCOUNT+'</span>\n' +
                                '</span>\n' +
                                '<img class="fr bbqgengdtc" itemId="'+data[j].ID+'" src="images/gengduo.png" />\n' +
                                '</div>\n' +
                                '</div>\n' +
                                '</li>';


                        }

                        if(refreshorload=='refresh'){
                            $("#contentUl").html(html);
                            $('.detailslist').pullToRefreshDone();

                        }
                        else if(refreshorload=='load'){
                            $("#contentUl").append(html);
                            $(".weui-loadmore").hide();
                        }
                        loading = false;
                    }

                    var listimgs = $('.listimgs').width();
                    $('.listimgs').height(listimgs);
                });
            }

            /**
             * 关注
             */
            function follow(bodyParam) {
                var hrt = new HttpRequestTool(url + 'AttendCancel', 'post', 'text', true, false, bodyParam, 'callBack');
                hrt.HttpRequest(function (response) {
                    var obj = JSON.parse(response);
                    var data = obj['Result'];
                    console.log(response);
                    $.toast("关注成功！", "text");
                });
            }


            /**
             * 话题收藏
             */
            function saveTalk(bodyParam) {
                var hrt = new HttpRequestTool(url + 'TalkSaveCancel', 'post', 'text', true, false, bodyParam, 'callBack');
                hrt.HttpRequest(function (response) {
                    var obj = JSON.parse(response);
                    var data = obj['Result'];
                    console.log(response);

                });
            }
            /**
             * 举报
             */
            function addReport(bodyParam) {
                var hrt = new HttpRequestTool(url + 'TalkReport', 'post', 'text', true, false, bodyParam, 'callBack');
                hrt.HttpRequest(function (response) {
                    var obj = JSON.parse(response);
                    var data = obj['Result'];
                    console.log(response);
                    $.toast("已提交举报信息！", "text");
                });
            }
            function listReport(bodyParam) {
                var hrt = new HttpRequestTool(url + 'cxReportReason', 'post', 'text', true, false, bodyParam, 'callBack');
                hrt.HttpRequest(function (response) {
                    var obj = JSON.parse(response);
                    var data = obj['Result'];
                    var html='';
                    for(j = 0,len=data.length; j < len; j++) {
                        html+=' <div class="tit jubaotit" itemId="'+data[j].ID+'">'+data[j].NM_T+'</div>\n';
                    }
                    html+=' <textarea class="tittext" placeholder="请输入举报内容" id="jbText" style="display: none;"></textarea>\n' +
                        ' <div class="titbtn" id="cancelJbBtn">取消</div>\n' +
                        ' <div class="titbtn bbqgreen" id="addJbBtn">完成</div>\n' ;

                    $('#jubaoDiv').html(html);




                });
            }

		</script>
	</body>

</html>