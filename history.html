<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<title>发布历史</title>
		<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
		<meta content="yes" name="apple-mobile-web-app-capable">
		<meta content="black" name="apple-mobile-web-app-status-bar-style">
		<meta content="telephone=no" name="format-detection">
		<link rel="stylesheet" href="css/weui.css">
		<link rel="stylesheet" href="css/jquery-weui.css">
		<link rel="stylesheet" href="css/style.css">
		<link rel="stylesheet" type="text/css" href="css/swipeslider.css">
		<link rel="stylesheet" href="css/baguetteBox.css">
		<link rel="stylesheet" type="text/css" href="css/dianzstyle.css"/>
		<link rel="stylesheet" href="css/wall.css"/>
	</head>

	<body>
		<div class="head">
			<div  class="indexreturn bbqreturn" onclick="window.history.go(-1)">
				<img src="images/houtui-icon.png" />
			</div>
			发布历史
		</div>

		<div class="detailslist">
			<div class="weui-pull-to-refresh__layer" >
				<div class='weui-pull-to-refresh__arrow'></div>
				<div class='weui-pull-to-refresh__preloader'></div>
				<div class="down">下拉刷新</div>
				<div class="up">释放刷新</div>
				<div class="refresh">正在刷新</div>
			</div>
			<div class="weui-tab__bd ">
				<ul class="weui-tab__bd-item weui-tab__bd-item--active bbqul mt0 p0" id="contentUl">
					<!--<li class="bbqlist mb1">
						<div class="bbqlistimg">
							<img src="images/9f10f09c24c4611808bcccd9b5302a3.jpg">
						</div>
						&lt;!&ndash;认证&ndash;&gt;
						<img class="renzicon" src="images/renzheng-left-icon.png">
						<img class="renzicons" src="images/renzheng-right-icon.png">
						<div class="bbqlistword">
							<p class="bbqname"><span class="vermiddle">我叫马铃薯</span><img class="bbqxb" src="images/nan-icon.png"></p>
							<p class="bbqtime">2分钟以前</p>
							<p class="bbqneir">我今天九年级了，我还得上补课班，我最爱吃冰激凌啦！</p>
							<div class="baguetteBoxOne  bbqlistimgs" >
								<a class="listimgs" style="background-image: url(images/9f10f09c24c4611808bcccd9b5302a3.jpg);" href="images/9f10f09c24c4611808bcccd9b5302a3.jpg" >
								</a>
								<a class="listimgs" style="background-image: url(images/9f10f09c24c4611808bcccd9b5302a3.jpg);" href="images/9f10f09c24c4611808bcccd9b5302a3.jpg" >
								</a>
								<a class="listimgs" style="background-image: url(images/9f10f09c24c4611808bcccd9b5302a3.jpg);" href="images/9f10f09c24c4611808bcccd9b5302a3.jpg">
								</a>
							</div>
							<div class="bbqbuttonthree posire">
								<div class="heart"  id="like1"  rel="like"></div>
								<span class="bbqbuttonspan likespan" id="likeCount1">99</span>
								<span class="locationpl">
								<img src="images/pinglun-icon.png" />
								<span class="bbqbuttonspan">999+</span>
							</span>
								<img class="fr bbqgengdtc" src="images/gengduo.png" />
							</div>
						</div>
					</li>
					<li class="bbqlist ">
						<div class="bbqlistimg">
							<img src="images/9f10f09c24c4611808bcccd9b5302a3.jpg">
						</div>
						&lt;!&ndash;认证&ndash;&gt;
						<img class="renzicon" src="images/renzheng-left-icon.png">
						<img class="renzicons" src="images/renzheng-right-icon.png">
						<div class="bbqlistword">
							<p class="bbqname"><span class="vermiddle">我叫马铃薯</span><img class="bbqxb" src="images/nan-icon.png"></p>
							<p class="bbqtime">2分钟以前</p>
							<p class="bbqneir">我今天九年级了，我还得上补课班，我最爱吃冰激凌啦！</p>
							<div class="baguetteBoxOne  bbqlistimgs" >
								<a class="listimgs" style="background-image: url(images/9f10f09c24c4611808bcccd9b5302a3.jpg);" href="images/9f10f09c24c4611808bcccd9b5302a3.jpg" >
								</a>
								<a class="listimgs" style="background-image: url(images/9f10f09c24c4611808bcccd9b5302a3.jpg);" href="images/9f10f09c24c4611808bcccd9b5302a3.jpg" >
								</a>
								<a class="listimgs" style="background-image: url(images/9f10f09c24c4611808bcccd9b5302a3.jpg);" href="images/9f10f09c24c4611808bcccd9b5302a3.jpg">
								</a>
							</div>
							<div class="bbqbuttonthree posire">
								<div class="heart"  id="like1"  rel="like"></div>
								<span class="bbqbuttonspan likespan" >99</span>
								<span class="locationpl">
								<img src="images/pinglun-icon.png" />
								<span class="bbqbuttonspan">999+</span>
							</span>
								<img class="fr bbqgengdtc" src="images/gengduo.png" />
							</div>

						</div>
					</li>-->
				</ul>
				<!--更多弹出-->
				<div class="bbqgengdtanc">
					<div class="gengdbg">
						<div class="tit" id="deleteBtn">删除</div>
						<div class="bbqqxbtn titbtn">取消</div>
					</div>
				</div>

				<script src="js/jquery.min.js"></script>
				<script src="js/jquery-weui.min.js"></script>
				<script src="js/jquery-2.1.4.js"></script>
				<script src="js/dianzan.js"></script>

			</div>
			<div class="weui-loadmore" style="display:none;">
				<i class="weui-loading"></i>
				<span class="weui-loadmore__tips">正在加载</span>
			</div>

		</div>

		<script src="js/jquery.min.js"></script>
		<script src="js/jquery-weui.min.js"></script>

		<!--图片展开-->
		<script src="js/baguetteBox.js" async></script>
		<script src="js/highlight.min.js" async></script>


		<!--具体功能实现-->
		<script src="js/main/barrageWall.js"></script>
		<script type="text/javascript" src="js/main/config.js"></script>
		<script>
            var page=1;
            var loading = false;
            var talkId;
            $(document).ready(function () {

                $('.detailslist').pullToRefresh().on('pull-to-refresh', function (done) {
                    var self = this;
                    $(self).find(".weui-loadmore").html('<i class="weui-loading"></i><span class="weui-loadmore__tips">正在加载</span>');


                    setTimeout(function() {
                        page=1;
                        var bodyParam = {'USER_ID': user_id,'PAGE':page};
                        listHistory(bodyParam,'refresh');
                    }, 1000);

                });

                $('body').infinite().on("infinite", function() {
                    var self = this;
                    if(loading) return;
                    $(self).find(".weui-loadmore").show();
                    loading = true;

                    setTimeout(function() {
                        page++;
                        var bodyParam = {'USER_ID': user_id,'PAGE':page};
                        listHistory(bodyParam,'load');

                    }, 1000);

                });



                var bodyParam= {'USER_ID': user_id,'PAGE':page};
                listHistory(bodyParam,'refresh');

                //删除弹出

                $('body').on('click','.bbqgengdtc',function(e){
                    $(".bbqgengdtanc").show();
                    $(".bbqqxbtn").click(function(){
                        $('.bbqgengdtanc').hide();
                    });
                    talkId=$(this).attr('itemId');
                    e.stopPropagation();
                });
                $("#deleteBtn").click(function() {

                    $('.bbqgengdtanc').hide();

                    var bodyParam = {'USER_ID': user_id,'TALK_ID':talkId};
                    delTalk(bodyParam);

                });
                //item 点击
                $('body').on('click','.bbqlist',function(){
                    window.location.href='post_details.html?id='+$(this).attr("itemId");
                });
                //头像点击
                $('body').on('click','.bbqlistimg',function(e){
                    window.location.href='user_details.html?id='+user_id;
                    e.stopPropagation();

                });

            });



            /**
             * 话题列表
             */
            function listHistory(bodyParam,refreshorload) {

                var hrt = new HttpRequestRefreshTool(url + 'TalkHistory', 'post', 'text', true, false, bodyParam, 'callBack');
                hrt.HttpRequest(function (response) {
                    var obj = JSON.parse(response);
                    var data = obj['Result'];

                    console.log(response);
                    var html='';

                    if(data.length==0&&refreshorload=='load'){
                        loading = true;
                        $(".weui-loadmore").show();
                        $(".weui-loadmore").html('<span class="weui-loadmore__tips">已无更多数据</span>');
                    }
                    else{
                        for(var j = 0,len=data.length; j < len; j++) {

                            var userid='0';
                            if(data[j].IS_HIDE=='否'){
                                userid= data[j].TALK_USER_ID;
                            }

                            if(data[j].I_UPIMG==null){
                                html+='<li class="bbqlist mb1" itemId="'+data[j].ID+'">\n' +
                                    '<div class="bbqlistimg" >\n' +
                                    '<img src="images/9f10f09c24c4611808bcccd9b5302a3.jpg">\n' +
                                    '</div>\n' ;
                            }
                            else{
                                html+='<li class="bbqlist mb1" itemId="'+data[j].ID+'">\n' +
                                    '<div class="bbqlistimg">\n' +
                                    '<img src="'+data[j].I_UPIMG+'" >\n' +
                                    '</div>\n' ;
                            }
                            if(data[j].RZ_STATUS!=null&&data[j].RZ_STATUS=='已认证'&&data[j].IS_HIDE=='否'){
                                html+='<img class="renzicon" src="images/renzheng-left-icon.png">\n' +
                                    '<img class="renzicons" src="images/renzheng-right-icon.png">\n';
                            }
                            if(data[j].SE_LV!=null&&data[j].SE_LV=='男'){
                                html+='<div class="bbqlistword" >\n'+
                                    '<p class="bbqname">'+data[j].NICKNAME+'<img class="bbqxb" src="images/nan-icon.png"></p>\n';
                            }
                            else{
                                html+='<div class="bbqlistword" >\n'+
                                    '<p class="bbqname">'+data[j].NICKNAME+'<img class="bbqxb" src="images/nv-icon.png"></p>\n';
                            }

                            if(data[j].OPEN_DT!=null){
                                html+='<p class="bbqtime">'+getDateDiff(data[j].OPEN_DT)+'</p>\n';
                            }
                            html+='<p class="bbqneir">'+data[j].TALK_CONTENT+'</p>\n' ;
                            html+='<div class="baguetteBoxOne  bbqlistimgs" >\n' ;
                            var contentImage=data[j].TALK_IMG;
                            if(contentImage!=null){
                                var contentImages=contentImage.split("|");
                                if(contentImages.length>0){
                                    for(var i = 0,imagelen=contentImages.length; i< imagelen;i++) {
                                       /* html+='<a class="listimgs" content="'+data[j].TALK_CONTENT+'" good="'+data[j].GOOD_COUNT+
											'" replay="'+data[j].REPLAYCOUNT+'" style="background-image: url('+contentImages[i]+');" href="'+contentImages[i]+'" >\n' +
                                            '</a>\n' ;*/
                                        html+='<a class="listimgs" itemId="'+data[j].ID+'" content="'+data[j].TALK_CONTENT+'" good="'+data[j].GOOD_COUNT+
                                            '" replay="'+data[j].REPLAYCOUNT+'" style="background-image: url('+contentImages[i]+');" href="'+contentImages[i]+'" >\n' +
                                            '</a>\n' ;

                                    }

                                }
                            }
                            html+='</div>\n' ;


                            html+='<div class="bbqbuttonthree ">\n' +
                                '<img src="images/dianzan-icon.png" />\n' +
                                '<span class="bbqbuttonspan">'+data[j].GOOD_COUNT+'</span>\n' +
                                '<span class="locationpl">\n' +
                                '<img src="images/pinglun-icon.png" />\n' +
                                '<span class="bbqbuttonspan">'+data[j].REPLAYCOUNT+'</span>\n' +
                                '</span>\n' +
                                '<img class="fr bbqgengdtc" itemId="'+data[j].ID+'" src="images/gengduo.png" />\n' +
                                '</div>\n' +
                                '</div>\n' +
                                '</li>';


                        }

                        if(refreshorload=='refresh'){
                            $("#contentUl").html(html);
                            $('.detailslist').pullToRefreshDone();

                        }
                        else if(refreshorload=='load'){
                            $("#contentUl").append(html);
                            $(".weui-loadmore").hide();
                        }
                        loading = false;
                    }

                    var listimgs = $('.listimgs').width();
                    $('.listimgs').height(listimgs);



                    baguetteBox.run('.baguetteBoxOne');

                });
            }
            /**
             * 话题删除
             */
            function delTalk(bodyParam) {
                console.log(JSON.stringify(bodyParam));
                var hrt = new HttpRequestTool(url + 'delTalk', 'post', 'text', true, false, bodyParam, 'callBack');
                hrt.HttpRequest(function (response) {
                    var obj = JSON.parse(response);
                    var data = obj['Result'];
                    console.log(response);
                    $.toast("删除成功！", "text");
                    $('.bbqlist[itemId="'+talkId+'"]').remove();

                });
            }


		</script>

	</body>

</html>