<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<title>详情</title>
		<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
		<meta content="yes" name="apple-mobile-web-app-capable">
		<meta content="black" name="apple-mobile-web-app-status-bar-style">
		<meta content="telephone=no" name="format-detection">
		<link rel="stylesheet" href="css/weui.css">
		<link rel="stylesheet" href="css/jquery-weui.css">
		<link rel="stylesheet" href="css/style.css">
		<link rel="stylesheet" type="text/css" href="css/swipeslider.css">
		<link rel="stylesheet" href="css/baguetteBox.css">
		<link rel="stylesheet" type="text/css" href="css/dianzstyle.css"/>
		<link rel="stylesheet" href="css/wall.css"/>
	</head>

	<body>
	<div class="head">
		<div  class="indexreturn bbqreturn" >
			<img src="images/houtui-icon.png" />
		</div>
		详情
	</div>

	<div class="weui-tab__bd pt50"  >


		<ul class="weui-tab__bd-item weui-tab__bd-item--active bbqul mt0 p0">
			<li class="bbqlist" id="detailTalk">
				<!--<div class="bbqlistimg">
					<img src="images/9f10f09c24c4611808bcccd9b5302a3.jpg">
				</div>
				&lt;!&ndash;认证&ndash;&gt;
				<img class="renzicon" src="images/renzheng-left-icon.png">
				<img class="renzicons" src="images/renzheng-right-icon.png">
				<div class="bbqlistword">
					<p class="bbqname"><span class="vermiddle">我叫马铃薯</span><img class="bbqxb" src="images/nan-icon.png"></p>
					<p class="bbqtime">2分钟以前</p>
					<p class="bbqneir">我今天九年级了，我还得上补课班，我最爱吃冰激凌啦！</p>
					<div class="baguetteBoxOne  bbqlistimgs" >
						<a class="listimgs" style="background-image: url(images/9f10f09c24c4611808bcccd9b5302a3.jpg);" href="images/9f10f09c24c4611808bcccd9b5302a3.jpg" >
						</a>
						<a class="listimgs" style="background-image: url(images/9f10f09c24c4611808bcccd9b5302a3.jpg);" href="images/9f10f09c24c4611808bcccd9b5302a3.jpg" >
						</a>
						<a class="listimgs" style="background-image: url(images/9f10f09c24c4611808bcccd9b5302a3.jpg);" href="images/9f10f09c24c4611808bcccd9b5302a3.jpg">
						</a>
					</div>
					<div class="bbqbuttonthree posire">
						<div class="heart"  id="like1"  rel="like"></div>
						<span class="bbqbuttonspan likespan" id="likeCount1">99</span>
						<span class="locationpl">
							<img src="images/pinglun-icon.png" />
							<span class="bbqbuttonspan">999+</span>
						</span>
						<img class="fr bbqgengdtc" src="images/gengduo.png" />
					</div>
				</div>-->
			</li>
		</ul>
		<div class="bbqlist pb70 "  >

			<p class="bbqpl">所有评论</p>
			<ul id="listComment">
				<!--<li class="pllist">
					<div class="pllistimg">
						<img src="images/9f10f09c24c4611808bcccd9b5302a3.jpg">
					</div>
					&lt;!&ndash;认证&ndash;&gt;
					<img class="renzdeicon" src="images/renzheng-left-icon.png">
					<img class="renzdeicons" src="images/renzheng-right-icon.png">
					<div class="pllistword">
						<div class="bbqplname">
							<p class="plname">我叫马铃薯</p>
							<div class="plbut">
								<span class="plbutspan">9</span>
								<img src="images/pinglun-icon.png" />
								<div class="plbut posire">
									<span class="plbutspan" id="">99</span>
									<div class="heart"  id="like1"  rel="like" style="right: 1px;left: inherit;top: -18px;"></div>
								</div>
							</div>
						</div>
						<p class="bbqtime">2分钟以前</p>
						<p class="bbqneir">我今天九年级了，我还得上补课班，我最爱吃冰激凌啦！</p>
						<div class="pltwo">
							<p><span class="bbqbla">我叫马铃薯：</span>我也是</p>
							<p><span class="bbqbla">我叫马铃薯：</span>我也是</p>
							<span class="pltiaoz">查看全部<span>10</span>条评论></span>

						</div>
					</div>
				</li>
				<li class="pllist">
					<div class="pllistimg">
						<img src="images/9f10f09c24c4611808bcccd9b5302a3.jpg">
					</div>
					<div class="pllistword">
						<div class="bbqplname">
							<p class="plname">我叫马铃薯</p>
							<div class="plbut">
								<span class="plbutspan">9</span>
								<img src="images/dianza-icon-wdj.png" />
							</div>
						</div>
						<p class="bbqtime">2分钟以前</p>
						<p class="bbqneir">我今天九年级了，我还得上补课班，我最爱吃冰激凌啦！</p>
					</div>
				</li>-->
			</ul>
			<div class="weui-loadmore" >
				<i class="weui-loading"></i>
				<span class="weui-loadmore__tips">正在加载</span>
			</div>
		</div>

		<div class="bbqshur bbqwid90">
			<span class="bbqgreen">丨</span>输入你的评论
		</div>
	</div>


	<!--收藏弹出-->
	<div class="bbqshoucangtanc">
		<img src="images/shoucang-icon.png">
	</div>

	<!--更多弹出-->
	<div class="bbqgengdtanc">
		<div class="gengdbg">
			<div class="tit bbqscbtn">收藏</div>
			<div class="tit bbqjbbtn">举报</div>
			<div class="bbqqxbtn titbtn">取消</div>
		</div>
	</div>
	<!--举报弹出-->
	<div class="bbqjubtanc" style="display: none;">
		<div class="gengdbg" id="jubaoDiv">
			<!--<div class="tit">广告或垃圾</div>
			<div class="tit">违反相关法律法规或管理规定</div>
			<div class="tit">引战或过于偏激的主观判断</div>
			<div class="tit">低俗或色情</div>
			<div class="tit">泄露他人隐私</div>
			<div class="tit">其他</div>
			<textarea class="tittext" placeholder="请输入举报内容"></textarea>
			<div class="titbtn">取消</div>
			<div class="titbtn bbqgreen">完成</div>-->
		</div>
	</div>


	<script src="js/jquery.min.js"></script>
	<script src="js/jquery-weui.min.js"></script>
	<script src="js/dianzan.js"></script>


	<!--图片展开-->
	<script src="js/baguetteBox.js" async></script>
	<script src="js/highlight.min.js" async></script>


	<!--具体功能实现-->
	<script src="js/main/barrageWall.js"></script>
	<script type="text/javascript" src="js/main/config.js"></script>
	<script>

        var page=1;
        var loading = false;
		$(document).ready(function () {

            var loading = false;  //状态标记


            $('body').infinite(200).on("infinite", function() {
                var self = this;
                if(loading) return;
                $(".weui-loadmore").show();
                loading = true;
                setTimeout(function() {
                    page++;
                    var bodyParam = {'USER_ID': user_id,'TALK_ID':GetQueryString('id'),'PAGE':page};
                    listComment(bodyParam,'load');

                }, 1000);

            });


			var bodyParam = {'USER_ID': user_id,'TALK_ID':GetQueryString('id')};
			detailTalk(bodyParam);


			var bodyParam = {'USER_ID': user_id,'TALK_ID':GetQueryString('id'),'PAGE':page};
			listComment(bodyParam,'refresh');
            listReport();

			$("body").on('click','.pltiaoz',function(){
				window.location.href='comment_details.html?id='+GetQueryString('id')+'&pid='+$(this).attr('itemId');
			});
			$("body").on('click','.bbqshur',function(){
				window.location.href='comment_tc.html?id='+GetQueryString('id')+'&type=talk';
			});
			$("body").on('click','.addSubComment',function(){
				window.location.href='comment_tc.html?id='+GetQueryString('id')+'&pid='+$(this).attr('itemId')+'&type=comment';
			});


			$('.bbqreturn').click(function(){
				history.go(-1);
			});


            //收藏弹出

            $('body').on('click','.bbqgengdtc',function(e){
                $(".bbqgengdtanc").show();
                $(".bbqqxbtn").click(function(){
                    $('.bbqgengdtanc').hide();
                });
                talkId=$(this).attr('itemId');
                e.stopPropagation();
            });

            $(".bbqscbtn").click(function() {
                $('.bbqshoucangtanc').show();
                $('.bbqgengdtanc').hide();
                setTimeout(function() { //定时器
                        $(".bbqshoucangtanc").css("display", "none");

                    },
                    1000);
                var bodyParam = {'USER_ID': user_id,'TALK_ID':talkId,'SAVECEN':'1'};
                saveTalk(bodyParam);

            });




            //举报弹出
            $(".bbqjbbtn").click(function() {

                $('.bbqjubtanc').show();
                $('.bbqgengdtanc').hide();

            });
            $('body').on('click','#cancelJbBtn',function () {
                $('.bbqjubtanc').hide();
            });
            $('body').on('click','.jubaotit',function () {
                $('.jubaotit').removeClass('bbqtcxz');
                $(this).addClass('bbqtcxz');
                if($(this).text()=='其他'){
                    $('#jbText').show();
                }
                else{
                    $('#jbText').hide();
                }
            });
            $('body').on('click','#addJbBtn',function () {
                if($('#jubaoDiv .bbqtcxz').length==0){
                    $.toast("请选择举报原因！", "text");
                    return false;
                }

                var bodyParam = {'USER_ID': user_id,'TALK_ID':talkId,'REPORT_REASON_ID':$('.bbqtcxz').attr('itemId')};
                if($('.bbqtcxz').text()=='其他'){
                    if($('#jbText').val()==''){
                        $.toast("请输入举报原因！", "text");
                        return false;
                    }
                    bodyParam['REPORT_REASON_OTHER']=$('#jbText').val();
                }
                addReport(bodyParam);
                $('.bbqjubtanc').hide();
            });



            //头像点击
            $('body').on('click','.bbqlistimg',function(e){
                if($(this).attr("itemId")!='0'){
                    window.location.href='user_details.html?id='+$(this).attr("itemId");
                }
                e.stopPropagation();

            });
            $('body').on('click','.pllistimg',function(e){
                if($(this).attr("itemId")!='0'){
                    window.location.href='user_details.html?id='+$(this).attr("itemId");
                }
                e.stopPropagation();

            });
        });
		/**
		 * 话题
		 */
		function detailTalk(bodyParam) {
			var hrt = new HttpRequestTool(url + 'cxTalkIndex', 'post', 'text', true, false, bodyParam, 'callBack');
			hrt.HttpRequest(function (response) {
				var obj = JSON.parse(response);
				console.log(response);
				var data = obj['Result'];
				if(data!=null){
					var html='';
					for(var j = 0,len=data.length; j < len; j++) {

                        var userid='0';
                        if(data[j].IS_HIDE=='否'){
                            userid= data[j].TALK_USER_ID;
                        }

						if (data[j].IS_HIDE == '是' || data[j].I_UPIMG == null) {
							html += '<div class="bbqlistimg" itemId="'+userid+'">\n' +
								'<img src="images/9f10f09c24c4611808bcccd9b5302a3.jpg">\n' +
								'</div>\n';
						}
						else {
							html += '<div class="bbqlistimg" itemId="'+userid+'">\n' +
								'<img src="' + data[j].I_UPIMG + '">\n' +
								'</div>\n';
						}
						if (data[j].RZ_STATUS != null && data[j].RZ_STATUS == '已认证' && data[j].IS_HIDE == '否') {
							html += '<img class="renzicon" src="images/renzheng-left-icon.png">\n' +
								'<img class="renzicons" src="images/renzheng-right-icon.png">\n';
						}


						if (data[j].SE_LV != null && data[j].SE_LV == '男') {
							html += '<div class="bbqlistword" >\n' +
								'<p class="bbqname">' + data[j].NICKNAME + '<img class="bbqxb" src="images/nan-icon.png"></p>\n';
						}
						else {
							html += '<div class="bbqlistword" >\n' +
								'<p class="bbqname">' + data[j].NICKNAME + '<img class="bbqxb" src="images/nv-icon.png"></p>\n';
						}

						if (data[j].OPEN_DT != null) {
							html += '<p class="bbqtime">' + getDateDiff(data[j].OPEN_DT) + '</p>\n';
						}
						html += '<p class="bbqneir">' + data[j].TALK_CONTENT + '</p>\n';
						html += '<div class="baguetteBoxOne  bbqlistimgs" >\n';
						var contentImage = data[j].TALK_IMG;
						if (contentImage != null) {
							var contentImages = contentImage.split("|");
							if (contentImages.length > 0) {
								for (i = 0, imagelen = contentImages.length; i < imagelen; i++) {
									/*html += '<a class="listimgs" style="background-image: url(' + contentImages[i] + ');" href="' + contentImages[i] + '" >\n' +
										'</a>\n';*/
                                    html+='<a class="listimgs" itemId="'+data[j].ID+'" content="'+data[j].TALK_CONTENT+'" good="'+data[j].GOOD_COUNT+
                                        '" replay="'+data[j].REPLAYCOUNT+'" like="'+data[j].GOOD+'" style="background-image: url('+contentImages[i]+');" href="'+contentImages[i]+'" >\n' +
                                        '</a>\n' ;
								}
							}
						}
						html += '</div>\n';

						var labels=data[j].LABEL_NAME;
						if(labels!=null){
							var labelArr=labels.split(",");
							if(labelArr.length>0){
								for(i = 0,labellen=labelArr.length; i< labellen;i++) {
									html+='<p class="bbqindexbiaoq" >#'+labelArr[i]+'</p>\n' ;
								}

							}
						}

						html += '<div class="bbqbuttonthree posire">\n';
						if(data[j].GOOD!=null&&data[j].GOOD=='已赞'){
							html+='<div class="heart hearttalk heartAnimation" itemId="'+data[j].ID+'" rel="unlike" style=""></div>';
						}
						else{
							html+='<div class="heart hearttalk" itemId="'+data[j].ID+'" rel="like"></div>\n';
						}
						html+='<span class="bbqbuttonspan likespan" >' + data[j].GOOD_COUNT + '</span>\n' +
							'<span class="locationpl">\n' +
							'<img src="images/pinglun-icon.png" />\n' +
							'<span class="bbqbuttonspan">' + data[j].REPLAYCOUNT + '</span>\n' +
							'</span>\n' +
							'<img class="fr bbqgengdtc" itemId="'+data[j].ID+'"  src="images/gengduo.png" />\n' +
							'</div>\n' +
							'</div>\n';
						if (data[j].HOT != null && data[j].HOT == '1') {
							html += '<div class="bbqremen"><img src="images/remen.png"></div>\n';
						}
					}
					$('#detailTalk').html(html);
				}
				//console.log(response);
				var listimgs = $('.listimgs').width();
				$('.listimgs').height(listimgs);

                baguetteBox.run('.baguetteBoxOne');
			});
		}
		/**
		 * 评论列表
		 */
		function listComment(bodyParam,refreshorload) {
			var hrt = new HttpRequestTool(url + 'getTalkReply', 'post', 'text', true, false, bodyParam, 'callBack');
			hrt.HttpRequest(function (response) {
				var obj = JSON.parse(response);
				var data = obj['Result'];
				console.log(response);
				if(data!=null) {
					var html = '';

                    if(data.length==0&&refreshorload=='load'){
                        loading = true;
                        $(".weui-loadmore").show();
                        $(".weui-loadmore").html('<span class="weui-loadmore__tips">已无更多数据</span>');
                    }
                    else{
                        for (var j = 0, len = data.length; j < len; j++) {

                            var good_count= data[j].GOOD_COUNT==null?0:data[j].GOOD_COUNT;

                            var userid='0';
                            if(data[j].IS_HIDE=='否'){
                                userid= data[j].C_ID;
                            }
                            if(data[j].IS_HIDE=='是'||data[j].I_UPIMG==null){
                                html+='<li class="pllist" itemId="'+data[j].ID+'">\n' +
                                    '<div class="pllistimg" itemId="'+userid+'">\n' +
                                    '<img src="images/9f10f09c24c4611808bcccd9b5302a3.jpg">\n' +
                                    '</div>\n' ;
                            }
                            else{
                                html+='<li class="pllist" itemId="'+data[j].ID+'">\n' +
                                    '<div class="pllistimg" itemId="'+userid+'">\n' +
                                    '<img src="'+data[j].I_UPIMG+'" >\n' +
                                    '</div>\n' ;
                            }

                            if (data[j].RZ_STATUS != null && data[j].RZ_STATUS == '已认证' && data[j].IS_HIDE == '否') {
                                html += '<img class="renzdeicon" src="images/renzheng-left-icon.png">\n' +
                                    '<img class="renzdeicons" src="images/renzheng-right-icon.png">\n';
                            }
                            html+='<div class="pllistword">\n' +
                                '<div class="bbqplname">\n' +
                                '<p class="plname">'+data[j].NICKNAME+'</p>\n' +
                                '<div class="plbut">\n' +
                                '<span class="plbutspan">'+data[j].TOTAL+'</span>\n' +
                                '<img class="addSubComment" itemId="'+data[j].ID+'" src="images/pinglun-icon.png" />\n' +
                                '<div class="plbut posire">\n';
                            if(data[j].GOOD!=null&&data[j].GOOD=='已赞'){
                                html+='<div class="heart heartcomment heartAnimation" itemId="'+data[j].ID+'" rel="unlike" style="right: 1px;left: inherit;top: -18px;"></div>';
                            }
                            else{
                                html+='<div class="heart heartcomment"  itemId="'+data[j].ID+'"  rel="like" style="right: 1px;left: inherit;top: -18px;"></div>\n';
                            }
                            html+='<span class="plbutspan" id="">'+good_count+'</span>\n' +
                                '</div>\n' +
                                '</div>\n' +
                                '</div>\n' +
                                '<p class="bbqtime">'+data[j].TIME+'</p>\n' +
                                '<p class="bbqneir">'+data[j].REPLY_CONTENT+'</p>\n';

                            var subcomment=data[j].SUN;

                            if(subcomment.length>0){
                                html+='<div class="pltwo">\n' ;
                                for(i = 0,sublen=subcomment.length; i< sublen;i++) {
                                    html+='<p><span class="bbqbla">'+subcomment[i].NICKNAME+':</span>'+subcomment[i].REPLY_CONTENT+'</p>\n' ;
                                    /*html+='<p><span class="bbqbla">'+subcomment[i].NICKNAME+' 回复 '+
                                        data[j].NICKNAME+'：</span>'+subcomment[i].REPLY_CONTENT+'</p>\n' ;*/
                                }
                                html+='<span class="pltiaoz" itemId="'+data[j].ID+'">查看全部<span>'+data[j].TOTAL+'</span>条评论></span>\n'+
                                    '</div>\n' ;
                            }

                            html+='</div>\n' +
                                '</li>';
                        }

                        if(refreshorload=='refresh'){
                            $('#listComment').html(html);


                        }
                        else if(refreshorload=='load'){
                            $('#listComment').append(html);

                        }
                        loading = false;
                        $(".weui-loadmore").hide();
					}

				}
			});
		}
		/**
		 * 话题点赞
		 */
		function admireTalk(bodyParam) {
			var hrt = new HttpRequestTool(url + 'GoodCancel', 'post', 'text', true, false, bodyParam, 'callBack');
			hrt.HttpRequest(function (response) {
				var obj = JSON.parse(response);
				var data = obj['Result'];
				console.log(response);


			});
		}
		/**
		 * 评论点赞
		 */
		function admireComment(bodyParam) {
			var hrt = new HttpRequestTool(url + 'GoodCancelReply', 'post', 'text', true, false, bodyParam, 'callBack');
			hrt.HttpRequest(function (response) {
				var obj = JSON.parse(response);
				var data = obj['Result'];
				console.log(response);

			});
		}

        /**
         * 话题收藏
         */
        function saveTalk(bodyParam) {
            var hrt = new HttpRequestTool(url + 'TalkSaveCancel', 'post', 'text', true, false, bodyParam, 'callBack');
            hrt.HttpRequest(function (response) {
                var obj = JSON.parse(response);
                var data = obj['Result'];
                console.log(response);


            });
        }
        /**
         * 举报
         */
        function addReport(bodyParam) {
            var hrt = new HttpRequestTool(url + 'TalkReport', 'post', 'text', true, false, bodyParam, 'callBack');
            hrt.HttpRequest(function (response) {
                var obj = JSON.parse(response);
                var data = obj['Result'];
                console.log(response);
                $.toast("已提交举报信息！", "text");
            });
        }
        function listReport(bodyParam) {
            var hrt = new HttpRequestTool(url + 'cxReportReason', 'post', 'text', true, false, bodyParam, 'callBack');
            hrt.HttpRequest(function (response) {
                var obj = JSON.parse(response);
                var data = obj['Result'];
                var html='';
                for(j = 0,len=data.length; j < len; j++) {
                    html+=' <div class="tit jubaotit" itemId="'+data[j].ID+'">'+data[j].NM_T+'</div>\n';
                }
                html+=' <textarea class="tittext" placeholder="请输入举报内容" id="jbText" style="display: none;"></textarea>\n' +
                    ' <div class="titbtn" id="cancelJbBtn">取消</div>\n' +
                    ' <div class="titbtn bbqgreen" id="addJbBtn">完成</div>\n' ;

                $('#jubaoDiv').html(html);




            });
        }


	</script>

	</body>

</html>